<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Not Wordle (1)</title>
  <style>
    :root {
      font-size: 16pt;
      --clr-bg: #141414;
      --clr-fg: #f0f0f0;
      --clr-fg-dim: #606060;
      --clr-incorrect: #303030;
      --clr-correct: #437d3e;
      --clr-partial: #b59f3b;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont,
        avenir next, avenir, segoe ui, Cantarell,
        helvetica neue, helvetica, Ubuntu, roboto,
        noto, arial, sans-serif;
      background-color: var(--clr-bg);
      color: var(--clr-fg);
      max-width: 20rem;
      padding: 0 .5rem;
      margin: auto;
      margin-bottom: 2rem;
    }
    h1 {
      margin-bottom: .5rem;
      margin-top: .5rem;
      text-align: center;
    }
    #display {
      margin: auto;
      margin-bottom: .5rem;
    }
    .row {
      margin-bottom: .3rem;
      display: flex;
    }
    .cell {
      border-top: .05rem solid var(--clr-fg-dim);
      border-bottom: .05rem solid var(--clr-fg-dim);
      height: 2rem;
      width: 2rem;
      text-align: center;
      line-height: 2rem;
    }
    .cell:nth-child(1) {
      border-radius: 8px 0 0 8px;
      border-left: 1px solid var(--clr-fg-dim);
    }
    .cell:nth-last-child(1) {
      border-radius: 0 8px 8px 0;
      border-right: 1px solid var(--clr-fg-dim);
    }
    .cell + .cell {
      border-left: 1px solid var(--clr-fg-dim);
    }
    .correct {
      background: var(--clr-correct);
      border-color: var(--clr-bg);
    }
    .cell + .correct {
      border-color: var(--clr-bg);
    }
    .correct:nth-child(1) {
      border-color: var(--clr-bg);
    }
    .partial {
      background: var(--clr-partial);
      border-color: var(--clr-bg);
    }
    .cell + .partial {
      border-color: var(--clr-bg);
    }
    .partial:nth-child(1) {
      border-color: var(--clr-bg);
    }
    .incorrect {
      background: var(--clr-incorrect);
      border-color: var(--clr-bg);
    }
    .cell + .incorrect {
      border-color: var(--clr-bg);
    }
    .incorrect:nth-child(1) {
      border-color: var(--clr-bg);
    }
    input {
      display: block;
      background: inherit;
      color: inherit;
      font-size: inherit;
      border: .05rem solid var(--clr-fg);
      border-radius: 8px;
      border-bottom: .1rem solid var(--clr-fg);
      height: 2rem;
      padding: 0 .5rem;
      margin: auto;
    }
    #instruction {
      color: var(--clr-fg-dim);
    }
    p {
      margin-top: .25rem;
      margin-bottom: 0;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Not Wordle (1)</h1>

  <div id=display></div>

  <input id='input'
    placeholder='Guess Here'
    type=text
    autocapitalize=off
    autocomplete=off>
  </input>
  <p id=instruction></p>

  <script>
    'use strict';

    // avoid word longer than 6 characters,
    // since it might not fit on a mobile screen
    // and avoid word shorter than 4 characters
    // since that reduces width of text input
    // and cuts off placeholder text
    const WORD = 'mistake';
    const MAX_GUESSES = 6;
    const VALID_CHARS = '[A-Z]';

    const display = document.getElementById('display');
    const input = document.getElementById('input');
    const instruction = document.getElementById('instruction');

    const answer = WORD.toUpperCase();
    const answerLength = answer.length;

    const rows = Array(MAX_GUESSES).fill(' ');
    const columns = Array(answerLength).fill(' ');

    display.style.width = `${answerLength * 2}rem`;
    input.style.width = `${answerLength * 2}rem`;
    input.setAttribute('minlength', answerLength);
    input.setAttribute('maxlength', answerLength);

    instruction.innerText = `Type ${answerLength} letters`;

    let guesses = 0;

    //// Count letters
    //// for tracking yellow

    let totalCount = {};
    for (let letter of answer) {
      totalCount[letter] = totalCount[letter] ? totalCount[letter] + 1 : 1;
    }

    //// Draw Grid

    for ( let rowIdx in rows ) {
      let row = document.createElement('div');
      row.className = 'row';
      row.id = `row-${rowIdx}`;
      display.appendChild(row);
      for ( let columnIdx in columns ) {
        let cell = document.createElement('div');
        cell.className = 'cell';
        cell.id = 'cell-' + rowIdx + '-' + columnIdx;
        row.appendChild(cell);
        cell.append(' ');
      }
    }

    //// Check guess

    // takes guess as uppercase string
    function checkCorrect(guess) {
      let result = [];
      let count = {};
      Object.assign(count, totalCount);
      for (let letterIdx in guess) {
        let isMatch = guess[letterIdx] == answer[letterIdx];
        if ( isMatch ) {
          let letter = guess[letterIdx];
          result.push('correct');
          count[letter] -= 1;
        } else {
          result.push('');
        }
      }
      return [result, count];
    }

    // takes guess as uppercase string
    function checkPartiallyCorrect(guess, guessValidity, count) {
      let result = guessValidity;
      for (let letterIdx in guess) {
        let letter = guess[letterIdx];
        let isPresent = answer.includes(letter);
        let isAvailable = count[letter] > 0 && result[letterIdx] == '';
        if ( isPresent && isAvailable ) {
          result[letterIdx] = 'partial';
          count[letter] -= 1;
        }
      }
      return result;
    }

    // takes guess as uppercase string
    function displayGuess(guess, validatedGuess, rowIdx) {
      for (let letterIdx in guess) {
        let letter = guess[letterIdx];
        let cellState = validatedGuess[letterIdx];
        let columnIdx = letterIdx;
        let cellId = 'cell-' + rowIdx + '-' + columnIdx;
        let cell = document.getElementById(cellId);
        cell.innerText = letter;
        if (cellState != '') {
          cell.classList.add(cellState);
        } else {
          cell.classList.add('incorrect');
        }
      }
    }

    //// Handle input

    input.addEventListener('keyup', (e) => {
      // remove anything that isn't a-z or A-Z
      let validInput = '';
      for (let letter of input.value) {
        if ( letter.toUpperCase().match(VALID_CHARS) ) {
          validInput += letter;
        }
      }
      input.value = validInput;

      const guess = input.value.toUpperCase();
      const isValid = guess.match(`${VALID_CHARS}{${answerLength}}`);
      const remainingChars = answerLength - guess.length;

      // update instructions
      if ( remainingChars == 0) {
        instruction.innerText = "Press 'Enter' to guess";
      } else if ( remainingChars == 1) {
        instruction.innerText = `Type 1 letter`;
      } else {
        instruction.innerText = `Type ${remainingChars} letters`;
      }

      // truncate input because some browsers
      // don't truncate to maxlength
      if ( input.value.length > answerLength ) {
        input.value = input.value.slice(0, answerLength);
      }

      // submit guess if valid
      if ( e.key == 'Enter' && isValid ) {
        input.value = '';
        let [correct, count] = checkCorrect(guess);
        let validatedGuess = checkPartiallyCorrect(guess, correct, count);
        let rowIdx = guesses;
        guesses++;
        displayGuess(guess, validatedGuess, rowIdx);
        if (guess == answer) {
          input.outerHTML = `<p>You got it in ${guesses}!<p>`;
          instruction.outerHTML = '';
        }
        if (guesses == MAX_GUESSES) {
          input.outerHTML = `<p>Awww... The answer was '${answer}'.<p>`;
          instruction.outerHTML = '';
        }
      }
    });
  </script>
</body>
</html>
